<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
    <body class="bg-gray-100 text-gray-900">
   <div class="max-w-5xl grid grid-cols-3 gap-6 mx-auto p-6">
    <!-- left Product -->
     <div class="col-span-2">
        <h3 class="text-xl font-bold">Shop</h3>
        <!-- Search -->
        <div class="flex gap-2 mt-3">
            <Input id="search" type="text" class="px-2 py-1 border border-gray-500 rounded w-64" placeholder="Search Products...">
            <button onclick="searchProductsByName()" class="px-3 py-1 bg-blue-600 text-white rounded ">Search</button>
        </div>

        <!-- Product Cart -->
         <div id="product" class="grid grid-cols-2 gap-4 mt-4">
            




         </div>
   </div>
   <!-- Right Cart -->
      <div class="col-span-1">
        <!-- Title-->
      <h3 class="text-xl font-bold">Cart</h3>
      <!-- List -->
      <ul id="cart" class="space-y-2">
        
        


      </ul>
      <p id="total">Total: $ 0</p>

      <button class="w-full px-3 py-2 bg-green-600 text-white rounded">Checkout</button>




    <script>
        const API = 'https://fakestoreapi.com'
        let ProductListing = []

        const productElement = document.getElementById('product')
        const cartElement = document.getElementById('cart')

        const searchProductsByName = () => {
            const search = document.getElementById("search").value
            console.log('Testing search', search)
           const filterProduct = ProductList.filter(product => product.title.toLowerCase().includes(search.toLowerCase()))
           console.log("Filtered product", filterProduct)
           renderProducts(filterProduct)
        }

        // Render product card
        const renderProducts = (products) => {

            productElement.innerHTML = ''

            if(products.length === 0){
                productElement.innerHTML = '<p class="text-red-500">Product not found</p>'
            }
            products.forEach(product => {
                const div = document.createElement('div')
                div.className = 'border border-none p-2 rounded bg-white'
                div.innerHTML = `
                
                    <img class="w-40 h-32 object-contain rounded mb-2 bg-gray-50 mx-auto" src=${product.image} />
                    <h3 class="font-bold text-xl">${product.title}</h3>
                    <p>$ ${product.price}</p>
                    <button id="btnAddToCart" class="mt-2 px-2 py-1 bg-green-500 text-white rounded">Add To Cart</button>
                
                `
                div.querySelector('#btnAddToCart').onclick = () => addToCart(product)
                productElement.appendChild(div)

            });
        }

        let productCart = []

        const addToCart = (product)=>{
            console.log('addToCart', product)
            const found = productCart.find(cart => cart.id === product.id)
            if(found){
                console.log("Product already in cart")
                found.qty += 1
            }else{
                productCart.push({
                    id: product.id,
                    title: product.title,
                    price: product.price,
                    image: product.image,
                    qty: 1
                })
            }
            
            renderProductCart()
        }
        const removeCart = (product) =>{
            //const found = productCart.find(cart => cart.id === product.id)
            //if (found){
                //found.qty -= 1
            //}
            const foundIndex = productCart.findIndex(cart => cart.id === product.id)
            if (foundIndex > -1) {
                productCart[foundIndex].qty -=1
                if (productCart[foundIndex].qty <= 0){
                    productCart.splice(foundIndex, 1)
                }
            }
            renderProductCart()
        }
        const addCart = (product) =>{
            const found = productCart.find(cart => cart.id === product.id)
            if (found){
                found.qty += 1
            }
            renderProductCart()
        }

        const renderProductCart = () => {
            let total = 0
            cartElement.innerHTML = ''
            productCart.forEach(cart => {
                total = total + (cart.price * cart.qty)
                //or total += cart.price * cart.qty
                const li = document.createElement('li')
                li.className = 'flex item-center gap-2 border border-none rounded p-2 bg-white'
                li.innerHTML = `
                <img class="w-12 h-12 object-contain rounded bg-gray-50" src=${cart.image} alt"">
            <div class="flex-1">
                <p>${cart.title}</p>
                <p>$ ${cart.price} X ${cart.qty} = $ ${(cart.price * cart.qty).toFixed(2)}</p>
            </div>
            <button id="btnRemove" class="px-3 py-2 bg-red-500 rounded text-white">-</button>
            <button id="btnAdd" class="px-3 py-2 bg-green-500 rounded text-white">+</button>
                `
                li.querySelector('#btnRemove').onclick = () => removeCart(cart)
                li.querySelector('#btnAdd').onclick = () => addCart(cart)
                cartElement.appendChild(li)

                
            })
            document.getElementById('total').innerText = `total: $ ${total.toFixed(2)}`
        }

        // Load function
        const loadProducts = async () => {
            console.log('First load')
            try {
                const res = await fetch(`${API}/products`)
                const data = await res.json()

                ProductList = data

                renderProducts(ProductList)

                console.log("Test data",data)
            } catch (error) {
                console.error('Error loading products:', error);
                
            }
        }


        window.onload = () =>{
            loadProducts()
        }


    </script>
  </body>
</html>

